"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["9651"],{7084:function(r,e,n){n.r(e),n.d(e,{default:function(){return d}});var a=n(5893),s=n(65);function t(r){let e=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",code:"code",h3:"h3",pre:"pre"},(0,s.ah)(),r.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.h1,{id:"gitea-installation",children:["Gitea installation",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#gitea-installation",children:"#"})]}),"\n",(0,a.jsxs)(e.h2,{id:"windows-ssh-copy-id",children:["windows ssh-copy-id",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#windows-ssh-copy-id",children:"#"})]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:'type %USERPROFILE%.ssh\\id_ed25519.pub | ssh ubuntu@192.168.3.208 "cat >> .ssh/authorized_keys"'})}),"\n",(0,a.jsxs)(e.h2,{id:"install-gitea",children:["install gitea",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#install-gitea",children:"#"})]}),"\n",(0,a.jsxs)(e.h3,{id:"add-git-user",children:["add git user",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#add-git-user",children:"#"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"adduser \\\r\n   --system \\\r\n   --shell /bin/bash \\\r\n   --gecos 'Git Version Control' \\\r\n   --group \\\r\n   --disabled-password \\\r\n   --home /home/git \\\r\n   git\n"})}),"\n",(0,a.jsxs)(e.h3,{id:"find-git-uid",children:["find git uid",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#find-git-uid",children:"#"})]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:"su - git  &&  echo $UID && exit"})}),"\n",(0,a.jsxs)(e.h3,{id:"perpare-ssh-from-host-to-docker",children:["perpare ssh from host to docker",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#perpare-ssh-from-host-to-docker",children:"#"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'sudo -u git ssh-keygen -t rsa -b 4096 -C "Gitea Host Key"\r\nsudo -u git cat /home/git/.ssh/id_rsa.pub | sudo -u git tee -a /home/git/.ssh/authorized_keys\r\nsudo -u git chmod 600 /home/git/.ssh/authorized_keys\n'})}),"\n",(0,a.jsxs)(e.h3,{id:"hack",children:["hack",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#hack",children:"#"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'cat <<"EOF" | sudo tee /usr/local/bin/gitea\r\n#!/bin/sh\r\nssh -p 20022 -o StrictHostKeyChecking=no git@127.0.0.1 "SSH_ORIGINAL_COMMAND=\\"$SSH_ORIGINAL_COMMAND\\" $0 $@"\r\nEOF\r\n\r\nsudo chmod +x /usr/local/bin/gitea\n'})}),"\n",(0,a.jsxs)(e.h3,{id:"docker-composeyml",children:["docker-compose.yml",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#docker-composeyml",children:"#"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'version: "3"\r\n\r\nnetworks:\r\n  git:\r\n    external: true\r\n\r\nservices:\r\n  server:\r\n    image: gitea/gitea:1.17\r\n    container_name: gitea\r\n    environment:\r\n      - USER_UID=113\r\n      - USER_GID=118\r\n      - GITEA__database__DB_TYPE=postgres\r\n      - GITEA__database__HOST=db:5432\r\n      - GITEA__database__NAME=gitea\r\n      - GITEA__database__USER=gitea_dba\r\n      - GITEA__database__PASSWD=gitea_p@ss\r\n    restart: always\r\n    networks:\r\n      - git\r\n    volumes:\r\n      - /data/gitea:/data\r\n      - /etc/timezone:/etc/timezone:ro\r\n      - /etc/localtime:/etc/localtime:ro\r\n      - /home/git/.ssh:/data/git/.ssh\r\n    ports:\r\n      - "3000:3000"\r\n      - "127.0.0.1:8022:22"\r\n    depends_on:\r\n       - db\r\n\r\n  db:\r\n    image: postgres:14\r\n    restart: always\r\n    environment:\r\n      - POSTGRES_USER=gitea_dba\r\n      - POSTGRES_PASSWORD=gitea_p@ss\r\n      - POSTGRES_DB=gitea\r\n    networks:\r\n      - git\r\n    volumes:\r\n      - /data/postgres:/var/lib/postgresql/data\r\n\n'})}),"\n",(0,a.jsxs)(e.h1,{id:"giteaconfappini",children:["gitea/conf/app.ini",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#giteaconfappini",children:"#"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"APP_NAME = 中科星启\r\nRUN_MODE = prod\r\nRUN_USER = git\r\n\r\n[repository]\r\nROOT = /data/git/repositories\r\n\r\n[repository.local]\r\nLOCAL_COPY_PATH = /data/gitea/tmp/local-repo\r\n\r\n[repository.upload]\r\nTEMP_PATH = /data/gitea/uploads\r\n\r\n[server]\r\nAPP_DATA_PATH    = /data/gitea\r\nDOMAIN           = cq.domain.com\r\nSSH_DOMAIN       = cq.domain.com\r\nHTTP_PORT        = 3000\r\nROOT_URL         = http://cq.domain.com:8021/\r\nDISABLE_SSH      = false\r\nSSH_PORT         = 8022\r\nSSH_LISTEN_PORT  = 22\r\nLFS_START_SERVER = true\r\nLFS_JWT_SECRET   = vTC6UDhAhhk0MqZlsob8rdo9YnsNWmqiMhQr3T_i5x0\r\nOFFLINE_MODE     = false\r\n\r\n[database]\r\nPATH     = /data/gitea/gitea.db\r\nDB_TYPE  = postgres\r\nHOST     = db:5432\r\nNAME     = gitea\r\nUSER     = gitea_dba\r\nPASSWD   = gitea_p@ss\r\nLOG_SQL  = false\r\nSCHEMA   = \r\nSSL_MODE = disable\r\nCHARSET  = utf8\r\n\r\n[indexer]\r\nISSUE_INDEXER_PATH = /data/gitea/indexers/issues.bleve\r\n\r\n[session]\r\nPROVIDER_CONFIG = /data/gitea/sessions\r\nPROVIDER        = file\r\n\r\n[picture]\r\nAVATAR_UPLOAD_PATH            = /data/gitea/avatars\r\nREPOSITORY_AVATAR_UPLOAD_PATH = /data/gitea/repo-avatars\r\nDISABLE_GRAVATAR              = false\r\nENABLE_FEDERATED_AVATAR       = true\r\n\r\n[attachment]\r\nPATH = /data/gitea/attachments\r\n\r\n[log]\r\nMODE      = console\r\nLEVEL     = info\r\nROUTER    = console\r\nROOT_PATH = /data/gitea/log\r\n\r\n[security]\r\nINSTALL_LOCK                  = true\r\nSECRET_KEY                    = \r\nREVERSE_PROXY_LIMIT           = 1\r\nREVERSE_PROXY_TRUSTED_PROXIES = *\r\nINTERNAL_TOKEN                = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYmYiOjE2NjE1OTIxMDh9.ckGoUy0qNaLn7rts3wZhyuDEp9h_4hOsTBn_neXle9k\r\nPASSWORD_HASH_ALGO            = pbkdf2\r\n\r\n[service]\r\nDISABLE_REGISTRATION              = false\r\nREQUIRE_SIGNIN_VIEW               = false\r\nREGISTER_EMAIL_CONFIRM            = false\r\nENABLE_NOTIFY_MAIL                = false\r\nALLOW_ONLY_EXTERNAL_REGISTRATION  = false\r\nENABLE_CAPTCHA                    = false\r\nDEFAULT_KEEP_EMAIL_PRIVATE        = false\r\nDEFAULT_ALLOW_CREATE_ORGANIZATION = true\r\nDEFAULT_ENABLE_TIMETRACKING       = true\r\nNO_REPLY_ADDRESS                  = noreply.localhost\r\nDISABLE_REGISTRATION              = true\r\n\r\n[lfs]\r\nPATH = /data/git/lfs\r\n\r\n[mailer]\r\nENABLED = true\r\nFROM = gitea@cq.domain.com\r\nUSE_SENDMAIL = false\r\nHOST = postfix:25\r\n\r\n[openid]\r\nENABLE_OPENID_SIGNIN = true\r\nENABLE_OPENID_SIGNUP = true\r\n\r\n[repository.pull-request]\r\nDEFAULT_MERGE_STYLE = merge\r\n\r\n[repository.signing]\r\nDEFAULT_TRUST_MODEL = committer\r\n\r\n[cron]\r\n\r\n;; Synchronize external user data (only LDAP user synchronization is supported)\r\n[cron.sync_external_users]\r\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\r\nENABLED = true\r\n;; Synchronize external user data when starting server (default false)\r\n;RUN_AT_START = false\r\n;; Notice if not success\r\n;NOTICE_ON_SUCCESS = false\r\n;; Interval as a duration between each synchronization (default every 24h)\r\nSCHEDULE = @every 30m\r\n;; Create new users, update existing user data and disable users that are not in external source anymore (default)\r\n;;   or only create new users if UPDATE_EXISTING is set to false\r\n;UPDATE_EXISTING = true\r\n\n"})})]})}function i(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,s.ah)(),r.components);return e?(0,a.jsx)(e,{...r,children:(0,a.jsx)(t,{...r})}):t(r)}let d=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["notes%2F02-Software%20Development%2Ftool%2F52-git%2Fgitea.md"]={toc:[{text:"windows ssh-copy-id",id:"windows-ssh-copy-id",depth:2},{text:"install gitea",id:"install-gitea",depth:2},{text:"add git user",id:"add-git-user",depth:3},{text:"find git uid",id:"find-git-uid",depth:3},{text:"perpare ssh from host to docker",id:"perpare-ssh-from-host-to-docker",depth:3},{text:"hack",id:"hack",depth:3},{text:"docker-compose.yml",id:"docker-composeyml",depth:3}],title:"gitea/conf/app.ini",frontmatter:{}}}}]);