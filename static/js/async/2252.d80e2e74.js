"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["2252"],{9898:function(n,e,r){r.r(e),r.d(e,{default:()=>a});var l=r("5893"),i=r("65");let t=r.p+"static/image/3223a7b541f5113fae0ac20bcb271d1.911dda3d.png";function s(n){let e=Object.assign({h1:"h1",a:"a",p:"p",img:"img",h2:"h2",pre:"pre",code:"code",ol:"ol",li:"li",blockquote:"blockquote"},(0,i.ah)(),n.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(e.h1,{id:"mysql-三级等保整改",children:["MySQL 三级等保整改",(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#mysql-三级等保整改",children:"#"})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)("img",{src:t,alt:"Alt text"})}),"\n",(0,l.jsxs)(e.h2,{id:"mysql基本操作",children:["MySQL基本操作",(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#mysql基本操作",children:"#"})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"    -- 创建用户\r\n    create user 'admin'@'%' identified by '***';\r\n    -- 更改密码\r\n    alter user 'dev_xl'@'%' IDENTIFIED with mysql_native_password by '****';\r\n    -- 重命名\r\n    rename user 'admin_xl'@'192.168.200.16' to 'admin_xl'@'%';\r\n    -- 刷新权限\r\n    FLUSH PRIVILEGES;\r\n    -- 赋予权限\r\n    grant all privileges on *.* to 'admin_xl'@'%';\r\n    -- 收回权限\r\n    revoke all privileges on *.* from 'admin_xl'@'%';\r\n    -- 查看当前登录的用户\r\n    select current_user()\r\n    -- 查看当前登录的用户角色\r\n    select current_role()\n"})}),"\n",(0,l.jsxs)(e.h2,{id:"定期更密码",children:["定期更密码",(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#定期更密码",children:"#"})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"show global variables like 'default_password_lifetime';\r\n\n"})}),"\n",(0,l.jsxs)(e.h2,{id:"登录失败处理",children:["登录失败处理",(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#登录失败处理",children:"#"})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Install plugin connection_control soname \"connection_control.so\"; \r\nINSTALL PLUGIN CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS SONAME 'connection_control.so';\r\n\r\n查看\r\nselect plugin_name,plugin_status from INFORMATION_SCHEMA.PLUGINS where PLUGIN_NAME LIKE 'connection%';\r\n\r\nshow variables like \"%connection_control%\"; \r\n\r\nconnection_control_failed_connections_threshold：在服务器增加后续连接尝试的延迟之前，允许客户端进行的连续失败连接尝试的次数。\r\nconnection_control_min_connection_delay：对于超出阈值的每个连续连接失败，要添加的延迟量。\r\nconnection_control_max_connection_delay：要添加的最大延迟。\r\n\r\n当然，最好是要去my.cnf的文件中添加参数，这是改动后的参数。\r\n \r\n     connection_control_failed_connections_threshold=5  \r\n     connection_control_min_connection_delay=1800000\r\n     connection_control_max_connection_delay=1800000\r\n\n"})}),"\n",(0,l.jsxs)(e.h2,{id:"超时处理",children:["超时处理",(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#超时处理",children:"#"})]}),"\n",(0,l.jsx)(e.p,{children:"Mysql 连接超时退出主要看三个参数："}),"\n",(0,l.jsx)(e.p,{children:"wait_timeout ：这个参数的单位是秒，默认是28880"}),"\n",(0,l.jsx)(e.p,{children:"interactive_timeout ：交互式登录超时"}),"\n",(0,l.jsx)(e.p,{children:"connect_timeout =10"}),"\n",(0,l.jsx)(e.p,{children:"mysql在使用交互式操作的时候，就是你打开mysql黑窗口进行的操作时使用的是wait_timeout，默认已经配置好了。 在使用非交互式操作时候，就是interactive_timeout，例如你程序的jdbc连接数据库。"}),"\n",(0,l.jsxs)(e.h2,{id:"访问控制",children:["访问控制",(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#访问控制",children:"#"})]}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"首先创建三个角色：操作员、审计员、管理员。\r\n操作员：负责业务层面开发，对应我们开发人员。\r\n审计员：只需对日志具有审查权限\r\n管理员：拥有所有的权限，制定安全策略。"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.code,{children:"create role 'system_db','dev_db','log_db';"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"创建用户，给管理员角色分配所有权限。禁止将file，process ,super 权限分给管理员之外的人员。"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:" GRANT ALL privileges on *.* to 'system_db'@'%' with grant option;\r\ncreate user 'admin'@'%' identified by 'giantAdmin@2021';\r\ngrant 'system_db' to 'admin'@'%';\n"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"查看该角色的权限。"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"show grants for 'admin'@'%';\n"})}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"注：USAGE 是连接（登陆）权限，建立一个用户，就会自动授予其usage权限（默认授予）。该权限不能被回收"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"创建用户，给开发角色分配权限。"}),"\n",(0,l.jsx)(e.p,{children:"对于开发人员：\r\n1）赋予用户对数据库的增删改操作；\r\n2）赋予用户创建，修改，删除表结构；操作mysql外键权限、操作临时表权限、操作索引权限、操作mysql视图、操作mysql存储过程权限；\r\n3）赋予用户全局权限：reload，process。查看所有进程"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"create user 'dev_user'@'%' identified by 'User_2022';\r\ngrant 'dev_db' to 'dev_user'@'%';\n"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"创建审计员，分配角色"}),"\n",(0,l.jsx)(e.p,{children:"分配审计人员对auditlog库的查询和插入删除权限。"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"create user 'log_user'@'%' identified by 'User_2022';\r\ngrant 'log_db' to 'log_user'@'%';\r\n\r\ngrant insert,select,delete on auditlog.t_audit to 'log_db';\r\ngrant reload,process on *.* to 'log_db'@'%';\n"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"激活角色"}),"\n",(0,l.jsx)(e.p,{children:"需要注意的是，角色创建后，并不会直接激活，激活的方式有几种，但推荐的一种就是去配置文件配置参数。"}),"\n",(0,l.jsx)(e.p,{children:"当用户登录后，可以查看该角色是否存在。查看参数是off状态。更改位on，该角色在登录后就会被自动激活。"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"\r\nselect current_role();\r\nshow global variables like 'activate_all_roles_on_login';\n"})}),"\n",(0,l.jsxs)(e.h2,{id:"安全审计",children:["安全审计",(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#安全审计",children:"#"})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",children:"    general_log=on\r\n    general_log_file=/var/lib/mysql/auditlog.log\r\n    log_timestamps=system\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"    create database auditlog;  \r\n\r\n    create table auditlog.t_audit(\r\n        id int not null auto_increment, \r\n        thread_id int not null, \r\n        login_time timestamp, \r\n        localname varchar(50) default null, \r\n        matchname varchar(50) default null, \r\n        primary key (id) \r\n        )ENGINE=InnoDB default charset=utf8 comment '审计用户登录信息'; \r\n \r\n    grant insert on auditlog.t_audit to 'dev_db';\r\n    grant insert,select,delete on auditlog.t_audit to 'log_db';\r\n\r\n\r\n    init-connect='insert into auditlog.t_audit(id,thread_id,login_time,localname,matchname) values(null,connection_id(),now(),user(),current_user());'\r\n\r\n\n"})}),"\n",(0,l.jsxs)(e.h2,{id:"mycnf",children:["my.cnf",(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#mycnf",children:"#"})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",children:"[mysqld]\r\nplugin-load-add=connection_control.so\r\ndefault_password_lifetime=90\r\nmax_connect_errors=5\r\nwait_timeout=1800\r\ninteractive_timeout=1800\r\nconnection_control_failed_connections_threshold=5\r\nconnection_control_min_connection_delay=1800000\r\nconnection_control_max_connection_delay=1800000\r\nactivate_all_roles_on_login=on\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:"https://blog.csdn.net/weixin_42586723/article/details/121057330",target:"_blank",rel:"noopener noreferrer",children:"索引"})})]})}function c(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,i.ah)(),n.components);return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(s,{...n})}):s(n)}let a=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["notes%2F03-Databases%20%26%20Data%20Storage%2Fmysql%2F%E7%AD%89%E4%BF%9D%E6%95%B4%E6%94%B9.md"]={toc:[{text:"MySQL基本操作",id:"mysql基本操作",depth:2},{text:"定期更密码",id:"定期更密码",depth:2},{text:"登录失败处理",id:"登录失败处理",depth:2},{text:"超时处理",id:"超时处理",depth:2},{text:"访问控制",id:"访问控制",depth:2},{text:"安全审计",id:"安全审计",depth:2},{text:"my.cnf",id:"mycnf",depth:2}],title:"MySQL 三级等保整改",frontmatter:{}}}}]);