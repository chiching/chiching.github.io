"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["7289"],{1028:function(e,r,n){n.r(r),n.d(r,{default:function(){return c}});var t=n(5893),o=n(65);function i(e){let r=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",h3:"h3",pre:"pre",code:"code",ul:"ul",li:"li"},(0,o.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.h1,{id:"binary-installation",children:["binary installation",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#binary-installation",children:"#"})]}),"\n",(0,t.jsxs)(r.h2,{id:"download-docker-xxxxxxtgz-from-bellow",children:["Download docker-xx.xx.xx.tgz from bellow",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#download-docker-xxxxxxtgz-from-bellow",children:"#"})]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.a,{href:"https://docs.docker.com/engine/install/binaries/",target:"_blank",rel:"noopener noreferrer",children:"https://docs.docker.com/engine/install/binaries/"}),"\r\n",(0,t.jsx)(r.a,{href:"https://download.docker.com/linux/static/stable/x86_64/",target:"_blank",rel:"noopener noreferrer",children:"https://download.docker.com/linux/static/stable/x86_64/"})]}),"\n",(0,t.jsxs)(r.h2,{id:"tar--zxf-docker-201017tgz--sudo-cp-docker-usrlocalbin",children:["tar -zxf docker-20.10.17.tgz && sudo cp docker/* /usr/local/bin/",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#tar--zxf-docker-201017tgz--sudo-cp-docker-usrlocalbin",children:"#"})]}),"\n",(0,t.jsxs)(r.h2,{id:"containerd",children:["containerd",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#containerd",children:"#"})]}),"\n",(0,t.jsxs)(r.h3,{id:"配置文件",children:["配置文件",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#配置文件",children:"#"})]}),"\n",(0,t.jsx)(r.p,{children:"修改image"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:'sudo mkdir /etc/containerd && containerd config default | sudo tee /etc/containerd/config.toml \r\n\r\n# 修改配置\r\nsudo sed -ri \'s@(sandbox_image = ").*(")@\\1registry.aliyuncs.com/google_containers/pause:3.6\\2@ \' /etc/containerd/config.toml\r\nsudo sed -ri \'/registry.mirrors/a\\\\n[plugins."io.containerd.grpc.v1.cri".registry.mirrors."aliyuncs"]\\nendpoint = ["https://em738s4i.mirror.aliyuncs.com"]\' /etc/containerd/config.toml \r\nsudo sed -i \'s/SystemdCgroup = false/SystemdCgroup = true/\' /etc/containerd/config.toml\r\n\r\n// or \r\nsed -i "s#k8s.gcr.io/pause:3.6#registry.aliyuncs.com/google_containers/pause:3.6#g" /etc/containerd/config.toml\n'})}),"\n",(0,t.jsxs)(r.h3,{id:"service-file",children:["service file",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#service-file",children:"#"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:'cat | sudo tee /lib/systemd/system/containerd.service <<EOF\r\n# Copyright The containerd Authors.\r\n#\r\n# Licensed under the Apache License, Version 2.0 (the "License");\r\n# you may not use this file except in compliance with the License.\r\n# You may obtain a copy of the License at\r\n#\r\n#     http://www.apache.org/licenses/LICENSE-2.0\r\n#\r\n# Unless required by applicable law or agreed to in writing, software\r\n# distributed under the License is distributed on an "AS IS" BASIS,\r\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n# See the License for the specific language governing permissions and\r\n# limitations under the License.\r\n\r\n[Unit]\r\nDescription=containerd container runtime\r\nDocumentation=https://containerd.io\r\nAfter=network.target local-fs.target\r\n\r\n[Service]\r\nExecStartPre=-/sbin/modprobe overlay\r\nExecStart=/usr/local/bin/containerd\r\n\r\nType=notify\r\nDelegate=yes\r\nKillMode=process\r\nRestart=always\r\nRestartSec=5\r\n# Having non-zero Limit*s causes performance problems due to accounting overhead\r\n# in the kernel. We recommend using cgroups to do container-local accounting.\r\nLimitNPROC=infinity\r\nLimitCORE=infinity\r\nLimitNOFILE=infinity\r\n# Comment TasksMax if your systemd version does not supports it.\r\n# Only systemd 226 and above support this version.\r\nTasksMax=infinity\r\nOOMScoreAdjust=-999\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\nEOF\n'})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"sudo systemctl enable --now containerd.service"})}),"\n",(0,t.jsxs)(r.h2,{id:"docker-configure-file",children:["Docker configure file",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#docker-configure-file",children:"#"})]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"sudo groupadd docker"})," to add a group, otherwise it will failed to start, with errors 'ocker.socket: Control process exited, code=exited, status=216/GROUP'"]}),"\n",(0,t.jsx)(r.p,{children:"If install k8s, not install docker, then following steps can be ignored."}),"\n",(0,t.jsx)(r.p,{children:"sudo mkdir -p /etc/docker"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:'cat | sudo tee /etc/docker/daemon.json <<EOF\r\n{\r\n  "exec-opts": ["native.cgroupdriver=systemd"],\r\n  "registry-mirrors": [\r\n    "https://docker.mirrors.ustc.edu.cn",\r\n    "http://hub-mirror.c.163.com"\r\n  ],\r\n  "max-concurrent-downloads": 10,\r\n  "log-driver": "json-file",\r\n  "log-level": "warn",\r\n  "log-opts": {\r\n    "max-size": "10m",\r\n    "max-file": "3"\r\n    },\r\n  "data-root": "/var/lib/docker"\r\n}\r\nEOF\n'})}),"\n",(0,t.jsxs)(r.h3,{id:"dockersocket",children:["docker.socket",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#dockersocket",children:"#"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"cat | sudo tee /lib/systemd/system/docker.socket <<EOF\r\n[Unit]\r\nDescription=Docker Socket for the API\r\n\r\n[Socket]\r\nListenStream=/run/docker.sock\r\nSocketMode=0660\r\nSocketUser=root\r\nSocketGroup=docker\r\n\r\n[Install]\r\nWantedBy=sockets.target\r\nEOF\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"systemctl enable --now docker.socket "})}),"\n",(0,t.jsxs)(r.h3,{id:"dockerd",children:["dockerd",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#dockerd",children:"#"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:'cat | sudo tee /lib/systemd/system/docker.service <<EOF\r\n[Unit]\r\nDescription=Docker Application Container Engine\r\nDocumentation=https://docs.docker.com\r\nAfter=network-online.target docker.socket firewalld.service containerd.service\r\nWants=network-online.target\r\nRequires=docker.socket containerd.service\r\n\r\n[Service]\r\nType=notify\r\n# the default is not to use systemd for cgroups because the delegate issues still\r\n# exists and systemd currently does not support the cgroup feature set required\r\n# for containers run by docker\r\nExecStart=/usr/local/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\r\nExecReload=/bin/kill -s HUP $MAINPID\r\nTimeoutSec=0\r\nRestartSec=2\r\nRestart=always\r\n\r\n# Note that StartLimit* options were moved from "Service" to "Unit" in systemd 229.\r\n# Both the old, and new location are accepted by systemd 229 and up, so using the old location\r\n# to make them work for either version of systemd.\r\nStartLimitBurst=3\r\n\r\n# Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.\r\n# Both the old, and new name are accepted by systemd 230 and up, so using the old name to make\r\n# this option work for either version of systemd.\r\nStartLimitInterval=60s\r\n\r\n# Having non-zero Limit*s causes performance problems due to accounting overhead\r\n# in the kernel. We recommend using cgroups to do container-local accounting.\r\nLimitNOFILE=infinity\r\nLimitNPROC=infinity\r\nLimitCORE=infinity\r\n\r\n# Comment TasksMax if your systemd version does not support it.\r\n# Only systemd 226 and above support this option.\r\nTasksMax=infinity\r\n\r\n# set delegate yes so that systemd does not reset the cgroups of docker containers\r\nDelegate=yes\r\n\r\n# kill only the docker process, not all processes in the cgroup\r\nKillMode=process\r\nOOMScoreAdjust=-500\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\nEOF\n'})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"sudo systemctl enable --now docker.service"})}),"\n",(0,t.jsxs)(r.h2,{id:"install-docker-compose-as-plugin",children:["install docker-compose as plugin",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#install-docker-compose-as-plugin",children:"#"})]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"mkdir -p ~/.docker/cli-plugins"}),", for all users on your system, replace ",(0,t.jsx)(r.code,{children:"~/.docker/cli-plugins"})," with ",(0,t.jsx)(r.code,{children:"/usr/local/lib/docker/cli-plugins"}),"."]}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"cp docker-compose /usr/local/lib/docker/cli-plugins/"})}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"ref:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://cloud.tencent.com/developer/article/1942278",target:"_blank",rel:"noopener noreferrer",children:"https://cloud.tencent.com/developer/article/1942278"})}),"\n",(0,t.jsx)(r.li,{children:"or docker envrionemnt"}),"\n"]})]})}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:r}=Object.assign({},(0,o.ah)(),e.components);return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(i,{...e})}):i(e)}let c=s;s.__RSPRESS_PAGE_META={},s.__RSPRESS_PAGE_META["notes%2F01-Cloud%20Computing%2FDocker%2Fbinary_install.md"]={toc:[{text:"Download docker-xx.xx.xx.tgz from bellow",id:"download-docker-xxxxxxtgz-from-bellow",depth:2},{text:"tar -zxf docker-20.10.17.tgz && sudo cp docker/* /usr/local/bin/",id:"tar--zxf-docker-201017tgz--sudo-cp-docker-usrlocalbin",depth:2},{text:"containerd",id:"containerd",depth:2},{text:"配置文件",id:"配置文件",depth:3},{text:"service file",id:"service-file",depth:3},{text:"Docker configure file",id:"docker-configure-file",depth:2},{text:"docker.socket",id:"dockersocket",depth:3},{text:"dockerd",id:"dockerd",depth:3},{text:"install docker-compose as plugin",id:"install-docker-compose-as-plugin",depth:2}],title:"binary installation",frontmatter:{}}}}]);