"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["7540"],{29:function(e,n,r){r.r(n),r.d(n,{default:function(){return t}});var l=r(5893),i=r(65);function s(e){let n=Object.assign({h1:"h1",a:"a",ul:"ul",li:"li",code:"code",em:"em",pre:"pre"},(0,i.ah)(),e.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.h1,{id:"达梦数据库迁移",children:["达梦数据库迁移",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#达梦数据库迁移",children:"#"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"安装数据库，一定要大小写不敏感。CASE_SENSITIVE=n, 否则orm中colum的大小写要完全一样，得一个一个改。"}),"\n",(0,l.jsx)(n.li,{children:"达梦是单数据库，多实列。每个库要建对应的表空间，用户。 用工具新建用户会自动创建模式。模式对应mysql中的一个数据库。 工具连接，必须用对应的用户查询，否则需要在表名前面加模式名前缀。"}),"\n",(0,l.jsx)(n.li,{children:"group_contact ->  wm_concat"}),"\n",(0,l.jsx)(n.li,{children:"union 操作，必须保证每列数据类型完全一样。"}),"\n",(0,l.jsx)(n.li,{children:"mysql的 STR_TO_DATE('2020-09-17 16:27:30','%Y-%m-%d %H:%i:%s') ->  TO_DATE('2020-09-17 16:27:30','YYYY-MM-DD HH24:MI:SS')"}),"\n",(0,l.jsx)(n.li,{children:"mysql的别名可以加单引号，如 select abc as 'alias' from xxx， 达梦不能加。"}),"\n",(0,l.jsx)(n.li,{children:"gorm数据查询，需要select指定具体列，如果是select * 映射失败。"}),"\n",(0,l.jsx)(n.li,{children:"计算一天前。select DATE_SUB( CURRENT_TIMESTAMP(), INTERVAL '1' DAY),  mysql 可不加单引号，达梦必须加。"}),"\n",(0,l.jsx)(n.li,{children:"DATE_FORMAT(CURRENT_TIMESTAMP,'%Y-%m-%d')  达梦不能是双引号。"}),"\n",(0,l.jsx)(n.li,{children:"窗口函数，partition后必须加order by"}),"\n",(0,l.jsxs)(n.li,{children:["mysql的特定函数，比如help_topic，达梦不支持。  有自己的解法",(0,l.jsx)(n.a,{href:"https://blog.csdn.net/mcband/article/details/123089081",target:"_blank",rel:"noopener noreferrer",children:"https://blog.csdn.net/mcband/article/details/123089081"})]}),"\n",(0,l.jsxs)(n.li,{children:["IF(contidtion, true, false), 达梦IF() 的返回值为数字值或字符串值，不能为NULL，也不能为变量。 可以这样判断 IFNULL(NULLIF(area, 0), 1)。 NULLIF(n1,n2)	如果n1=n2返回NULL，否则返回n1。  IFNULL(n1,n2) 当n1为非空时，返回n1；若n1为空，则返回n2  ",(0,l.jsx)(n.a,{href:"https://eco.dameng.com/community/question/2922dbe65be58ed994a6cf9f4989842a%EF%BC%8C",target:"_blank",rel:"noopener noreferrer",children:"https://eco.dameng.com/community/question/2922dbe65be58ed994a6cf9f4989842a，"})," ",(0,l.jsx)(n.a,{href:"https://eco.dameng.com/community/question/3d9dbaf4e5a8fbd1d8565d754579602b",target:"_blank",rel:"noopener noreferrer",children:"https://eco.dameng.com/community/question/3d9dbaf4e5a8fbd1d8565d754579602b"})]}),"\n",(0,l.jsxs)(n.li,{children:["select abc as ",(0,l.jsx)(n.code,{children:"key"})," from table， 达梦不支持，可以去掉反引号"]}),"\n",(0,l.jsx)(n.li,{children:"达梦没有FIND_IN_SET， 可以通过行转列，然后用in来实现。"}),"\n",(0,l.jsx)(n.li,{children:"类型转CONVERT， 字符串在前，类型在后。 达梦相反。"}),"\n",(0,l.jsx)(n.li,{children:"达梦没有SIGNED，unsigned数据类型。"}),"\n",(0,l.jsx)(n.li,{children:"达梦不能用别名直接group by, 需要在加一个外层查询。"}),"\n",(0,l.jsx)(n.li,{children:"Error -2685: 试图在blob或者clob列上排序或比较。 修改数据库参数ENABLE_BLOB_CMP_FLAG。sp_set_para_value(1,'ENABLE_BLOB_CMP_FLAG',1); ，然后重启服务。"}),"\n",(0,l.jsxs)(n.li,{children:["网上说的通过这种方式计算秒级别的加减法是不行的，now()- 1/(24",(0,l.jsx)(n.em,{children:"60"}),"60)*90， 后面的除法为0，可能还需要其他设置。 用这个 DATEADD(S, -90, now())，或者sysdate+numtodsinterval(-90,'second')"]}),"\n",(0,l.jsx)(n.li,{children:"容器内中文乱码，可给容器添加环境变量 LANG=en_US.UTF-8"}),"\n",(0,l.jsxs)(n.li,{children:["disql不能上下翻，可去",(0,l.jsx)(n.a,{href:"https://rpmfind.net/linux/rpm2html/search.php?query=rlwrap%E4%B8%8B%E8%BD%BD%E3%80%82%EF%BC%88EPEL",target:"_blank",rel:"noopener noreferrer",children:"https://rpmfind.net/linux/rpm2html/search.php?query=rlwrap下载。（EPEL"})," 8 for x86_64），然后解压，上传rlwrap到容器内。可能还需要拷贝以下文件到/usr/lib下，/usr/lib64/libtinfo.so.6.2，/usr/lib64/libtinfo.so.6， /usr/lib64/libreadline.so.7.0， /usr/lib64/libreadline.so.7， 可先使用命令，看提示错误确认文件版本。  kylin v10下载地址",(0,l.jsx)(n.a,{href:"https://archive.kylinos.cn/yum/v10/kylin-openstack-q/x86_64/x86_64/",target:"_blank",rel:"noopener noreferrer",children:"https://archive.kylinos.cn/yum/v10/kylin-openstack-q/x86_64/x86_64/"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  docker cp /opt/files/rlwrap/rlwrap dm-dm8_01-1:/usr/local/bin/\r\n  docker cp /usr/lib64/libreadline.so.7 dm-dm8_01-1:/usr/lib/\r\n  docker cp /usr/lib64/libtinfo.so.6.2 dm-dm8_01-1:/usr/lib/\r\n  docker cp /usr/lib64/libtinfo.so.6 dm-dm8_01-1:/usr/lib/\r\n  docker cp /usr/lib64/libreadline.so.7.0 dm-dm8_01-1:/usr/lib/\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"查询版本 SELECT * FROM v$version;"}),"\n",(0,l.jsx)(n.li,{children:"查询license过期 select * from v$license;"}),"\n",(0,l.jsxs)(n.li,{children:["DATEDIFF 的格式应该是 表达式 ",(0,l.jsx)(n.a,{href:"https://blog.csdn.net/Richarswing/article/details/124458728",target:"_blank",rel:"noopener noreferrer",children:"DATEDIFF(timeinterval,date1,date2)"})]}),"\n"]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(s,{...e})}):s(e)}let t=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["notes%2F03-Databases%20%26%20Data%20Storage%2Fdm-migrate.md"]={toc:[],title:"达梦数据库迁移",frontmatter:{}}}}]);